{% extends "admin_base.html" %}

{% load bootstrap4 %}

{% block title %}WoTT - Create Policy{% endblock title %}

{% block dashboard_title %}
  <h1>Create Policy</h1>
{% endblock dashboard_title %}

{% block admin_content %}
  <div class="row">
    <div class="col-12">
      <div class="wott-card wott-box-shadow">
        <!-- <div class="card-header">
          <h5 class="card-title">{{ object }}</h5>
        </div> -->
        <div class="wott-card-body">
          <form method="POST" action="" id="policy-form" class="py-3 px-4">
            {% csrf_token %}
            <!-- {% bootstrap_form form  %} -->
            <div class="form-group">
              <label class="wott-label" for="id_name">Name</label>
              <input type="text" name="name" maxlength="32" class="form-control wott-form-control wott-rounded-lg" placeholder="Name" title="" required="" id="id_name">
            </div>
            <div class="form-group">
              <label class="wott-label" for="id_policy">Firewall ports policy</label>
              <select name="policy" class="form-control wott-form-control wott-rounded-lg" title="" required="" id="id_policy">
                <option value="" selected="">---------</option>
                <option value="1">Allow by default</option>
                <option value="2">Block by default</option>
              </select>
            </div>

            <div class="form-group mb-4">
              <label class="wott-label" for="id_ports">Ports</label>
              <textarea name="ports" cols="40" rows="10" class="form-control form-control wott-form-control wott-rounded-lg" placeholder="Ports" title="" id="id_ports">[{"address": "0.0.0.0", "protocol": "udp", "port": 0, "ip_version": false}]</textarea>
              <div id="ports-table_wrapper" class="dataTables_wrapper dt-bootstrap4 no-footer">
                <div class="row">
                  <div class="col-sm-12 col-md-6"></div>
                  <div class="col-sm-12 col-md-6"></div>
                </div>
                <div class="row">
                  <div class="col-sm-12">
                    <table id="ports-table" class="table table-striped table-responsive-xs dataTable no-footer wott-table " style="width: 100%;" role="grid">
                      <thead>
                        <tr role="row">
                          <th width="5%" class="sorting_disabled" rowspan="1" colspan="1" aria-label=" " style="width: 14px;"></th>
                          <th width="30%" class="sorting_asc" tabindex="0" aria-controls="ports-table" rowspan="1" colspan="1" aria-sort="ascending" aria-label="Address: activate to sort column descending" style="width: 185px;">Address</th>
                          <th width="10%" class="sorting" tabindex="0" aria-controls="ports-table" rowspan="1" colspan="1" aria-label="Protocol: activate to sort column ascending" style="width: 56px;">Protocol</th>
                          <th width="20%" class="sorting" tabindex="0" aria-controls="ports-table" rowspan="1" colspan="1" aria-label="Port: activate to sort column ascending" style="width: 110px;">Port</th>
                          <th width="20%" class="sorting" tabindex="0" aria-controls="ports-table" rowspan="1" colspan="1" aria-label="IP version: activate to sort column ascending" style="width: 112px;">IP version</th>
                          <th width="20%" class="wott-kv-btns sorting_disabled" rowspan="1" colspan="1" aria-label="" style="width: 90px;"></th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr class="odd">
                          <td valign="top" colspan="6" class="dataTables_empty">No port rules defined.</td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
                <div class="row">
                  <div class="col-sm-12 col-md-5"></div>
                  <div class="col-sm-12 col-md-7"></div>
                </div>
              </div>
              <button type="button" class="btn wott-btn-small btn-wott-secondary mt-0 pr-4" id="add-port-btn">ï¼‹ Add Port</button>
            </div>
            <hr class="my-4 hr-create-policy">
            <!-- {% buttons %} -->
            <div class="form-group mb-0">
              <div class="d-flex justify-content-between">
                <button type="submit" class="btn wott-btn-medium btn-wott-primary">Save</button>
                <a href="{% url 'global_policies' %}" class="btn wott-btn-medium btn-wott-tertiary mr-2" role="button">Cancel</a>
              </div>
            </div>
            <!-- {% endbuttons %} -->
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock admin_content %}

{% block scripts %}
  {{ block.super }}
  {% include "policy_editor.html" %}

  <script>
      $(() => {
          let ports_table = init_policy_ports_editor(JSON.parse($('#id_ports').text()));

          $('#policy-form').submit(function (e) {
              $('#id_ports').html( parse_policy_ports_editor(ports_table));
              return true;
          });

      });
  </script>
{% endblock scripts %}