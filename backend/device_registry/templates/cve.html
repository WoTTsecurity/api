{% extends "admin_base.html" %}

{% block title %}WoTT - CVE list{% endblock title %}

{% block dashboard_title %}
  <h1 style="margin-bottom: 0">VULNERABILITIES{% if device_name %} for {{ device_name }}{% endif %}</h1>
{% endblock dashboard_title %}

{% load static %}

{% block admin_content %}
  <!-- cve.html -->
  <div class="container-fluid p-0">
    <div class="card">
      <div class="card-body">
        <table class="table table-striped table-responsive-xs" >
          <thead>
            <th>CVE</th>
            <th>Date</th>
            <th>Severity</th>
            <th>Packages Affected</th>
            {% if not device_name %}
            <th>Nodes Affected</th>
            {% endif %}
            <th>Solve</th>
          </thead>
          <tbody>
          {% for row in table_rows %}
          <tr>
            <td>
              <a href="{{ row.cve_link.href }}">{{ row.cve_link.text }}</a>
            </td>
            <td>{{ row.cve_date|date:"Y-m-d"|default:"N/A" }}</td>
            <td>{{ row.severity }}</td>
            <td>
              {% for p in row.packages %}
                {{ p.name }}
                <br>
              {% endfor %}
            </td>
            {% if not device_name %}
            <td>
              {% for p in row.packages %}
                <a href="#" class="wott-popover">
                  {{ p.devices_count }}
                  <template>
                    {% for du in p.devices %}
                      <a href="{{ du.href }}">{{  du.text }}</a><br>
                    {% endfor %}
                  </template>
                </a>
                <br>
              {% endfor %}
            </td>
            {% endif %}
            <td>
              {% for p in row.packages %}
                <a href="#" class="wott-popover">
                  Instructions
                  <template>
                    Run the following command:
                    <pre>{{ p.upgrade_command }}</pre>
                  </template>
                </a>
                <br>
              {% endfor %}
            </td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock admin_content %}

{% block scripts %}
{{ block.super }}

  <script>
  $(function () {
    $('[data-toggle="popover"]').popover()
  });

  $('.wott-popover').popover({
    html: true,
    title: "",
    trigger: 'click',
    content: function() {
        return $(this).children('template').html();
    }
  })

// Bellow we have just a reference of how we could style the graph with JS, the JS needs to be full builted
// The JS will need to:
// Change the clicked tag styleWidth to 4.
// Change the number inside the graph and its color
// Change the small text [low, high, medium] inside the circle
// COlORS: HIGH = #EF2F20 | MEDIUM = #EF8F20 | LOW = #23BED6;
// When clicking in other circle segment the previous one has to come back to strokeWidht = 3;

 $('#high-circle-segment').on('click', function() {
  document.getElementById('high-circle-segment').style.strokeWidth = 4;
  document.getElementById('cve-priority').textContent = "123";
  document.getElementById('cve-priority').style.fill = "#EF2F20";
  document.getElementById('severity-inner-text').textContent = "high";
 })

 // Popover JS require 2 functions
 // ## When opening the popover we should do => document.getElementById(.overlay).style.display = block;
 // ## When we close the popover we should do => document.getElementById('.overlay').style.display = hidden;

  </script>
{% endblock scripts %}